# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#     https://docs.fastlane.tools/plugins/available-plugins

# Reduce log verbosity
opt_out_usage

default_platform(:android)

platform :android do
  desc "Deploy dev build to Play Store Internal Testing track"
  lane :deploy_dev_internal do
    # This lane expects the AAB to already be built by Flutter
    # Upload to Play Store internal testing track
    # 
    # Note: Using 'completed' status for automatic publishing since app is in production
    upload_to_play_store(
      track: 'internal',
      aab: '../build/app/outputs/bundle/devRelease/app-dev-release.aab',
      skip_upload_metadata: true,
      skip_upload_images: true,
      skip_upload_screenshots: true,
      skip_upload_apk: true,
      release_status: 'completed',  # Automatically publish to internal testers
      json_key: ENV['GOOGLE_PLAY_SERVICE_ACCOUNT_JSON']
    )
    
    puts "✅ Dev build uploaded and published to Play Store Internal Testing track!"
  end

  desc "Deploy prod build to Play Store Open Testing (beta) track"
  lane :deploy_beta_open do
    # This lane expects the AAB to already be built by Flutter
    # Upload to Play Store open testing track
    # 
    # Note: Using 'completed' status for automatic publishing since app is in production
    upload_to_play_store(
      track: 'beta',
      aab: '../build/app/outputs/bundle/prodRelease/app-prod-release.aab',
      skip_upload_metadata: true,
      skip_upload_images: true,
      skip_upload_screenshots: true,
      skip_upload_apk: true,
      skip_upload_changelogs: true,
      release_status: 'completed',  # Automatically publish to beta testers
      json_key: ENV['GOOGLE_PLAY_SERVICE_ACCOUNT_JSON']
    )
    
    puts "✅ Beta build uploaded and published to Play Store Open Testing track!"
  end

  desc "Promote build from beta to production"
  lane :promote_to_production do
    # Promote the latest beta build to production
    # This can be done via Play Console UI or via fastlane
    upload_to_play_store(
      track: 'beta',
      track_promote_to: 'production',
      skip_upload_metadata: true,
      skip_upload_images: true,
      skip_upload_screenshots: true,
      skip_upload_apk: true,
      skip_upload_aab: true,
      json_key: ENV['GOOGLE_PLAY_SERVICE_ACCOUNT_JSON']
    )
    
    puts "✅ Build promoted to Production!"
  end
end
